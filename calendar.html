<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>calendar</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="calendar.css">
        <script type="text/javascript" src="calscript.js"></script>
        <script type="text/javascript" src="calendar.min.js"></script>
    </head>
    <body>
        
        <button id="login" class="login">login</button>
        <button id="register" class = "register">register</button>

        <h1>Your Calendar</h1>
        <h3 id="month_label"></h3>
        <button id="prev_month_btn">prev month</button>
        <button id="next_month_btn">next month</button>

        <div id="popUp">
            <div id="popUpHeader"></div>
            <div id="new_event">
                <input type="text" name="event_name" id="event_name" placeholder="event name" required><br> 
                <input type="text" name="start_date" id="start_date" placeholder="start date and time" required><br> 
                <input type="text" name="end_date" id="end_date"placeholder="end date and time" required><br> 
                <input type="text" name="location" id="location" placeholder="location" required><br>
                <input type="submit" name="submit" id = "submit" value="Add Event"><br><br>
            </div>
        </div>

        <div id="registering">
            <div id="popUpRegister"></div>
            <div id="new_user">
                <input type="text" name="username" id="username" placeholder="username" required><br> 
                <input type="password" name="password" id="password" placeholder="password" required><br> 
                <input type="submit" name="registerme" id = "registerme" value="register"><br><br>
            </div>
        </div>

        <div id="loggingin">
                <div id="popUpLogin"></div>
                <div id="existing_user">
                    <input type="text" name="username1" id="username1" placeholder="username" required><br> 
                    <input type="password" name="password1" id="password1" placeholder="password" required><br> 
                    <input type="submit" name="logmein" id = "logmein" value="login"><br><br>
                </div>
            </div>
       
        <table id="calendar">
            <tr>
                <td>Sunday</td><td>Monday</td><td>Tuesday</td><td>Wednesday</td><td>Thursday</td><td>Friday</td><td>Saturday</td>
            </tr>
            <tr id="week1" class="week"></tr>
            <tr id="week2" class="week"></tr>
            <tr id="week3" class="week"></tr>
            <tr id="week4" class="week"></tr>
            <tr id="week5" class="week"></tr>
        </table>
    </body>
</html>

<script>

    var currentMonth = new Month(2018, 9); // current month is October 2018
    document.getElementById("month_label").innerHTML = getMonthName()+" "+currentMonth.year;
    updateCalendar(); // show the calendar
    // Change the month when the "next" button is pressed
    document.getElementById("next_month_btn").addEventListener("click", function(){
        currentMonth = currentMonth.nextMonth();
        updateCalendar(); 
        document.getElementById("month_label").innerHTML = getMonthName() +" "+currentMonth.year;
    }, false);

    document.getElementById("prev_month_btn").addEventListener("click", function(){
        currentMonth = currentMonth.prevMonth();
        updateCalendar(); 
        document.getElementById("month_label").innerHTML = getMonthName() +" "+currentMonth.year;
    }, false);

   //login popup
    document.getElementById("login").addEventListener("click", function(){
        $('#popUpLogin').html('<br><h3>login</h3>');
        $('#username1').val("");
        $('#password1').val(""); //encrypt password here
        $('#logmein').val('login');
        $('#loggingin').dialog();
        $('#calendar').css('opacity', '.75');
    
        document.getElementById('logmein').addEventListener("click", function(){ //this isnt working and idk why
                let loginInfo = [$('#username1').val(), $('#password1').val()];
                checkingUser(loginInfo);
            }, false);
        
        $('#loggingin').on('dialogclose', function(event) {
            $('#calendar').css('opacity', '1');
         });

        }, false);

    function checkingUser(loginInfo){
   // $('#popUpRegister').dialog('close');
        
        $('#popUpLogin').closest('.ui-dialog-content').dialog('close');
        $.ajax({
            type: 'POST',
            url: 'checkUser.php', //gotta make this page
            data: { username: loginInfo[0], password: loginInfo[1] },
            success: function(response) {
                console.log(response);
            }
        });
        updateCalendar();
        }

    function getUser(){
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST", "http://ec2-18-207-202-216.compute-1.amazonaws.com/~gdlaming/checkUser.php", true); //gillians

        xmlHttp.addEventListener('load', function(e){
       if (xmlHttp.status == 200){
            let response = xmlHttp.responseText; // get json
            let parsed = JSON.parse(response); // parse json
            console.log("parsed")
            for (let i =0; i<parsed.length; i++){
                console.log("entered")
                let username = parsed[i].start_date.split(" ")[0];
                let password = parsed[i].start_date.split(" ")[1];
                console.log(username);
            }
       } 
        },)
    }
    
    //registration pop up
   document.getElementById("register").addEventListener("click", function(){
    
    $('#popUpRegister').html('<br><h3>register</h3>');
    $('#username').val("");
    $('#password').val(""); //encrypt password here
    $('#register').val('');
    $('#registering').dialog();
    $('#calendar').css('opacity', '.75');
    // let passwordHash = require('password-hash');
    // let hashedPassword = passwordHash.generate($('#password').val());
    document.getElementById('registerme').addEventListener("click", function(){ //this isnt working and idk why
        $('#password').val()
        let registration = [$('#username').val(), $('#password').val()];
        sendNewUser(registration);
    },false)

    $('#registering').on('dialogclose', function(event) {
        $('#calendar').css('opacity', '1');
    });
    
    }, false);


function sendNewUser(registration){
   // $('#popUpRegister').dialog('close');
    $('#popUpRegister').closest('.ui-dialog-content').dialog('close');
    $.ajax({
        type: 'POST',
        url: 'newUser.php', //gotta make this page
        data: { username: registration[0], password: registration[1] },
        success: function(response) {
            console.log(response);
        }
    });

updateCalendar();
}




    

</script>
